<html>

<head>
    <title>ggg</title>
    <style>
        body {
            background-color: grey;
        }
        
        #canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
        }
    </style>
</head>

<body>
    <div id="easing-wrapper"></div>

    <script src="pixi.js"></script>
    <script src="pixi-picture.umd.js"></script>
    <script src="draw.js"></script>
    <script src="colors.js"></script>
    <script src="curves.js"></script>
    <script src="perlin.js"></script>
    <script src="numbers.js"></script>
    <script src="bezier-easing.js"></script>
    <script src="index.js"></script>
    <script src="chroma.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pixi-filters@latest/dist/pixi-filters.js"></script>


    <script>



        var addText = function(text, x, y) {
            var text = new PIXI.Text(text, {
                fontFamily: 'Arial',
                fontSize: 12,
            });
            text.x = x;
            text.y = y;
            debuggingContainer.addChild(text);
        }


        let app = new PIXI.Application({
            width: 1168,
            height: 569,
            antialias: true,
            autoDensity: true,
            resolution: window.devicePixelRatio || 1,
            roundPixels: true,
            powerPreference: 'high-performance'
        });
        document.body.appendChild(app.view);

        highlightColor = generateColors()

        var debuggingContainer = new PIXI.Container();


        var trace = PIXI.Sprite.from('https://i.imgur.com/pKCVtIm.png');
       
       

        app.stage.addChild(debuggingContainer);


        var eyeMaskContainer = new PIXI.Container()
        var shape = new PIXI.Graphics();
        shape.beginFill(0x000000);
        shape.moveTo(205, 0);
        shape.bezierCurveTo(100, 370, -5, 310, -5, 310);
        shape.lineTo(0,0)
        shape.lineTo(210, 0)
        shape.endFill();
        eyeMaskContainer.addChild(shape);


        ///////// FILL STYLE & TEXTURE ////////////
        let fillContainer = new PIXI.Container()
        textureBackground = new PIXI.Graphics()

        hairColorPIXI = '#3a3403'
        hairColorPIXI = PIXI.utils.string2hex(hairColorPIXI)
        textureBackground.beginFill(hairColorPIXI, 1);
        textureBackground.drawRect(0, 0, 220, app.renderer.height);
        textureBackground.endFill();
        debuggingContainer.addChild(textureBackground)

        //use chroma.js to lighten 
        var lighten = chroma.scale([hairColorPIXI, '#ffffff']).mode('lch').colors(10)
        //get the first color in lighten and convert to hex
        var lightenHex = chroma(lighten[5]).hex()
        //remove some saturation from the color
        var lightenHex = chroma(lightenHex).saturate(-0.5).hex()
        //convert the color for use with PIXI
        var lightenPixi = PIXI.utils.string2hex(lightenHex)
        textureForeground = new PIXI.Graphics()
        for(var i = 0; i < 100000; i++){
            randomAlpha = randFloat(0, 0.065)
            //get a random number between 0 and 0.065
            textureForeground.beginFill(lightenPixi, randomAlpha)
            textureForeground.drawCircle(rand(0, 220), rand(0, app.renderer.height), rand(0.5, 0.9))
            textureForeground.endFill()
            //textureForeground.blendMode = PIXI.BLEND_MODES.ADD
        }
        grain = new PIXI.filters.OldFilmFilter({
            sepia: 0.0,
            noise: 0.06,
            noiseSize: 2,
            scratch: 0.0,
            scratchDensity: 0.0,
            scratchWidth: 0.0,
            vignetting: 0.0,
            vignettingAlpha: 0.0,
            vignettingBlur: 0.0,
            seed: 0.1,
        })
        //textureForeground.filters = [grain]
        blur = new PIXI.filters.KawaseBlurFilter(0.01)
        textureForeground.filters = [blur]
        sharpnessMatrix = new PIXI.filters.ConvolutionFilter(
            [0, -1, 0,
             -1, 5, -1,
             0, -1, 0],
            250, 250
        )
        sharpnessMatrixTwo = new PIXI.filters.ConvolutionFilter(
            [0, -1, 0,
             -1, 5, -1,
             0, -1, 0],
            20, 20
        )
        textureForeground.alpha = 0.5
        //var contrast = new PIXI.filters.AdjustmentFilter({ contrast: 1 });

        //textureForeground.filters = [blur, sharpnessMatrix, grain]\
        pixelate = new PIXI.filters.PixelateFilter(4)
        blur2 = new PIXI.filters.BlurFilter(0.5)
        textureForeground.filters = [blur, sharpnessMatrix, grain]

        //textureForeground.blendMode = PIXI.BLEND_MODES.OVERLAY
        fillContainer.addChild(textureBackground)
        fillContainer.addChild(textureForeground)
        fillContainer.mask = eyeMaskContainer
        app.stage.addChild(fillContainer)

        /* Line1 */
        //var lightenHex = chroma(lighten[0]).hex()
        var lightenPixi = PIXI.utils.string2hex('#554d0b')
        var pencilStyles = new pencil({
            startWidth: 2.5, 
            endWidth: 2.5, 
            iterations: 13,
            nib: 'square',
            nibSize: 0.5, 
            color: '#6f5a16', 
            alpha: 0.6,
            density: 1200,
            widthArray: ''
        })
        var lineOptions = new line({
            x:207,
            y:0, 
            cp1:-108, 
            cp2:370, 
            endX:-210, 
            endY:310, 
            cp3:-205, 
            cp4:310
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 6, 
            endWidth: 0.1, 
            iterations: 4,
            nib: 'circle',
            nibSize: 0.5, 
            color: '#476b60', 
            alpha: 0.1,
            density: 700,
            widthArray: ''
        })
        var lineOptions = new line({
            x:400,
            y:150, 
            cp1:0, 
            cp2:0, 
            endX:-190, 
            endY:-30, 
            cp3:-120, 
            cp4:-60
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 3, 
            endWidth: 0.1, 
            iterations: 4,
            nib: 'circle',
            nibSize: 0.5, 
            color: '#476b60', 
            alpha: 0.3,
            density: 700,
            widthArray: ''
        })
        var lineOptions = new line({
            x:400,
            y:150, 
            cp1:0, 
            cp2:0, 
            endX:-190, 
            endY:-30, 
            cp3:-120, 
            cp4:-60
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 55, 
            endWidth: 55, 
            iterations: 200,
            nib: 'oval',
            nibSize: 1, 
            nibOption: 65,
            color: '#ecaa4b', 
            alpha: 0.1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:290,
            y:300, 
            cp1:0, 
            cp2:0, 
            endX:5, 
            endY:5, 
            cp3:0, 
            cp4:0
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)

        var eyeX = 292
        var eyeY = 302
        var irisSize = 58
        var irisSizeY = 68

        let eyeBorderContainer = new PIXI.Container()
        let eyeBorderPencil = new pencil({startWidth: 3, endWidth: 3, iterations: 5, nib: 'circle', color: '#476b60', alpha: 0.1, widthArray: ''})
        let eyeBorderLine = new line({x:eyeX, y:eyeY - irisSizeY, cp1:0, cp2:0, endX:irisSize, endY:irisSizeY, cp3:irisSize, cp4:0})
        drawLine(eyeBorderLine, eyeBorderPencil, eyeBorderContainer)

        let eyeBorderPencilTwo = new pencil({startWidth: 3, endWidth: 1, iterations: 5, nib: 'circle', color: '#476b60', alpha: 0.1, widthArray: ''})
        let eyeBorderLineTwo = new line({x:eyeX + irisSize, y:eyeY, cp1:0, cp2:0, endX:-irisSize, endY:irisSizeY, cp3:0, cp4:irisSize})
        drawLine(eyeBorderLineTwo, eyeBorderPencilTwo, eyeBorderContainer)

        let eyeBorderPencilThree = new pencil({startWidth: 1, endWidth: 3, iterations: 5, nib: 'circle', color: '#476b60', alpha: 0.1, widthArray: ''})
        let eyeBorderLineThree = new line({x:eyeX, y:eyeY + irisSizeY, cp1:0, cp2:0, endX:-irisSize, endY:-irisSizeY, cp3:-irisSize, cp4:0})
        drawLine(eyeBorderLineThree, eyeBorderPencilThree, eyeBorderContainer)

        let eyeBorderPencilFour = new pencil({startWidth: 3, endWidth: 3, iterations: 5, nib: 'circle', color: '#476b60', alpha: 0.1, widthArray: ''})
        let eyeBorderLineFour = new line({x:eyeX - irisSize, y:eyeY, cp1:0, cp2:0, endX:irisSize, endY:-irisSizeY, cp3:0, cp4:-irisSizeY})
        drawLine(eyeBorderLineFour, eyeBorderPencilFour, eyeBorderContainer)
        eyeBorderContainer.pivot.x = eyeX
        eyeBorderContainer.pivot.y = eyeY
        eyeBorderContainer.x = eyeX
        eyeBorderContainer.y = eyeY
        eyeBorderContainer.rotation = -0.1
        app.stage.addChild(eyeBorderContainer)

        var pencilStyles = new pencil({
            startWidth: 7, 
            endWidth: 7, 
            iterations: 20,
            nib: 'oval',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 0.1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:285,
            y:310, 
            cp1:0, 
            cp2:0, 
            endX:2, 
            endY:2, 
            cp3:0, 
            cp4:0
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 3, 
            endWidth: 3, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 0.05,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:95,
            y:310, 
            cp1:0, 
            cp2:0, 
            endX:95, 
            endY:280, 
            cp3:0, 
            cp4:0
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 20, 
            endWidth: 20, 
            iterations: 2,
            nib: 'oval',
            nibOption: 12,
            nibSize: 0.5, 
            color: '#ecaa4b', 
            alpha: 0.4,
            density: 1200,
            widthArray: ''
        })
        var lineOptions = new line({
            x:520,
            y:530, 
            cp1:0, 
            cp2:0, 
            endX:70, 
            endY:10, 
            cp3:50, 
            cp4:20
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)

        var pencilStyles = new pencil({
            startWidth: 20, 
            endWidth: 20, 
            iterations: 2,
            nib: 'oval',
            nibOption: 10,
            nibSize: 0.5, 
            color: '#ecaa4b', 
            alpha: 0.4,
            density: 1200,
            reverseLine: true,
            widthArray: ''
        })
        var lineOptions = new line({
            x:510,
            y:530, 
            cp1:30, 
            cp2:-20, 
            endX:70, 
            endY:10, 
            cp3:50, 
            cp4:20
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)

     


        
        var pencilStyles = new pencil({
            startWidth: 3, 
            endWidth: 3, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 0.05,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:95,
            y:310, 
            cp1:0, 
            cp2:0, 
            endX:95, 
            endY:280, 
            cp3:0, 
            cp4:0
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 1, 
            endWidth: 1, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:415,
            y:300, 
            cp1:-30, 
            cp2:-70, 
            endX:-200, 
            endY:-45, 
            cp3:-130, 
            cp4:-100
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)

        var pencilStyles = new pencil({
            startWidth: 1, 
            endWidth: 1, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:415,
            y:350, 
            cp1:-30, 
            cp2:-100, 
            endX:-190, 
            endY:-60, 
            cp3:-160, 
            cp4:-100
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)


        var pencilStyles = new pencil({
            startWidth: 1, 
            endWidth: 1, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:410,
            y:360, 
            cp1:-140, 
            cp2:40, 
            endX:-185, 
            endY:-65, 
            cp3:-190, 
            cp4:-20
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)

        var underEyeStart = getPositionOnLine(pencilStyles, lineOptions, 0.3)
        console.log(underEyeStart)
        var lineOptions = new line({
            x:underEyeStart.x,
            y:underEyeStart.y, 
            cp1:-100, 
            cp2:20, 
            endX:-130, 
            endY:-78, 
            cp3:-133, 
            cp4:-40
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)



        var pencilStyles = new pencil({
            startWidth: 3, 
            endWidth: 3, 
            iterations: 4,
            nib: 'circle',
            nibSize: 1, 
            color: '#476b60', 
            alpha: 1,
            density: 300,
            widthArray: ''
        })
        var lineOptions = new line({
            x:520,
            y:540, 
            cp1:25, 
            cp2:-15, 
            endX:20, 
            endY:5, 
            cp3:20, 
            cp4:5
        })
        drawLine(lineOptions, pencilStyles, debuggingContainer)



        trace.x = 585
        //trace.blendMode = PIXI.BLEND_MODES.MULTIPLY;
        app.stage.addChild(trace)
        
        //app.stage.addChild(trace)


        
    </script>
</body>

</html>